========================================================
Частное техническое задание на разработку Системы Analog
========================================================

Определения, сокращения и аббревиатуры
--------------------------------------

+--------------+--------------------+------------------------------------+
| Аббревиатура | Термин             | Определение                        |
+==============+====================+====================================+
|              | Сущность           | Тип сведений, хранящихся в Базе    |
|              |                    | данных, имеющих одинаковые по      |
|              |                    | структуре свойства (поля)          |
+--------------+--------------------+------------------------------------+
|              | Экземпляр сущности | Уникально идентифицируемая единица |
|              |                    | сведений, хранящихся в БД,         |
|              |                    | относящаяся к какой-либо из        |
|              |                    | сущностей Системы                  |
+--------------+--------------------+------------------------------------+
| CRUD         | create, read,      | акроним, обозначающий четыре       |
|              | update, delete —   | базовые функции, используемые при  |
|              | «создать, прочесть,| работе с персистентными хранилищами|
|              | обновить, удалить» | данных:                            |
|              |                    |                                    |
|              |                    |   - создание;                      |
|              |                    |   - чтение;                        |
|              |                    |   - редактирование;                |
|              |                    |   - удаление.                      |
+--------------+--------------------+------------------------------------+

Общие сведения
--------------

Система **Analog** служит для подбора аналогов позиций спецификации 
предложений товаров, а также для учета производителей, товаров, 
предложений производителей и т. д.

Бизнес-процессы
---------------
Ведение экземпляров сущностей
  1. Пользователь с правами Администратора авторизуется в панели Администратора
  2. Открывает табличное представление справочника, в который требуется внести изменение
  3. Внесение изменений:

    1. Пользователь прямо из табличного представления удаляет одну или несколько записей, удаление перемещает запись в архив
    2. Для добавления записи пользователь нажимает соответствующую кнопку в табличном представлении, переходит на страницу карточки экземпляра сущности, заполняет ее и нажимает сохранить
    3. Для редактирования записи, пользователь находит ее в таблице, открывает карточку данной записи, вносит изменения и нажимает кнопку сохранить.

Подбор аналогов
  1. Пользователь авторизуется в системе
  2. Выбирает пункт меню – загрузить спецификацию. Открывается окно с выбором файла для загрузки. После нажатия ОК, появляется форма, в которой необходимо выбрать производителя, на котором сделана загружаемая спецификация. Производитель выбирается из выпадающего списка. Подтверждается нажатием ОК.
  3. Внесение параметров подбора: После загрузки спецификации и выбора производителя, появляется окно с формой запроса параметров подбора спецификации-аналога.

    Форма состоит из трех частей.
    
    Первая часть. «автоматический подбор». Из выпадающего списка выбирается производитель, на котором будет сделана исходящая спецификация.  Внизу формы две кнопки – Атрибуты и ОК. при выборе ОК – начинается подбор.
    
    Атрибуты – расширение формы вниз. Вторая часть. Форма динамическая! В этой части формы – перечень «мягких» атрибутов для каждого класса. Напротив каждого атрибута – значение по умолчанию с выпадающим списком возможных вариантов выбора. В форму выбираются только те атрибуты тех классов, товары которых есть во входной спецификации. «Лишние» классы и атрибуты  выводиться в форме не должны. Возможно разделение по классам для простоты понимания.
    
    Галочка к атрибуту «пересчет»
    
    Внизу также кнопки – Доп.атрибуты и ОК. при выборе ОК – начинается подбор. 
    
    Доп.Атрибуты – еще расширение формы вниз. Третья часть. В этой части формы – перечень «жестких» атрибутов для каждого класса. Форма также динамическая. Напротив каждого атрибута – значение по умолчанию с выпадающим списком возможных вариантов выбора.
    
    Алгоритм поиска замены
      Загруженная спецификация отрабатывается построчно. Каждой строке в выходной спецификации должна соответствовать строка исходной спецификации.

      Для каждого артикула i-той строки исходной спецификации производится поиск записи в БД.  В случае, если артикула исходн.спецификации в БД нет – в этой строке выходной спецификации указывается – артикул в БД не найден. 
      
      Если артикул найден, то с учетом данных найденной записи производится поиск записи аналога. Поиск производится с учетом того, что поля Класс, Тип должны полностью совпадать с параметрами записи исходной позиции, поле Производитель – с наименованием Производителя выбранном в форме запроса.
      
      Поиск и выбор среди атрибутов:
        поиск по атрибутам производится последовательно. Т.е. первый атрибут имеет больший приоритет перед последующим. Для жестких атрибутов требуется полное совпадение значений с исходной записью, если иное не указано в форме запроса. Для мягких атрибутов совпадения ищутся исходя параметров по умолчанию, если иное не указано в форме запроса. 
      
      После выбора позиции производится анализ атрибутов Пересчет, Взаимосвязь и Цена. Для атрибута Пересчет должен производится пересчет количества с округлением вверх до целого элемента. 
      
      Выходная спецификация должна быть составлена в тех же ед.измерения, что и входная

      .. image:: _static/Алгоритм.jpg

  4. Сохранение результатов
    
    После проведения поиска у пользователя запрашивается место для сохранения файла с результатом. Результат сохраняется в формате эксель. Столбцы – номер п/п, артикул, наименование, кол-во, ед.изм.

    В выходной спецификации на каждый элемент исходной спецификации должен быть представлен аналогичный элемент в выходной спецификации (с учетом параметров «взаимосвязь» общее количество элементов может незначительно отличаться). На один элемент исходной спецификации НЕ может быть представлено несколько вариантов в выходной спецификации
    
    Пользователь может определять формат вывода информации – указывать какие столбцы должны быть в «выходной» спецификации.
    
    В БД должны сохраняться все произведенные подборы в формате – «исходная спецификация – выходная спецификация» – с возможностью выгрузки для администратора единой совмещенной таблицы для удобного анализа – что было на входе, что стало на выходе.

Архитектура
-----------

По уровням доступа приложение делится на:

- публичную часть
  Доступ предоставляется всем пользователям Системы. Содержит функционал загрузки спецификации с целью подбора аналогов

- панель администратора
  Доступ предоставляется только пользователем с ролью Администратор. Содержит функционал учета экземпляров всех сущностей

Сущности
--------

1. Производитель

  - Наименование
  - Синонимы

2. Класс

  - Наименование
  - Виды/типы

3. Вид/тип

  - Наименование
  - Принадлежность к классу

4. Атрибут
5. Значение атрибута
6. Товар
7. Предложение
8. Спецификация

Представления
-------------

1. Таблица/перечень
2. Карточка экземпляра сущности
3. Другое

Роли
----

Администратор
  Пользователь, имеющий CRUD права сущности и их экземпляры
Менеджер
  Пользователь, имеющий права на создание и редактирование спецификаций

Справочники и классификаторы
----------------------------

Производители
  - A
  - XX
Классы
  - ШП
  - КНС
Виды/типы
  - ШП

    - Поворотный модуль

  - КНС

    - Прямая секция
Атрибуты
  - КНС/Прямая секция
    
    A. Жесткие

      1. Вид
      2. Покрытие
      3. Ширина, мм
      
    B. Мягкие
      
      1. Толщина, мм
      2. Высота борта, мм

    C. Пересчет

      1. Длина, мм

    D. Взаимосвязь

      1. Крепление

    E. Цена

      1. руб.

  - ШП/Поворотный модуль

    A. Жесткие

      1. Вид
      2. Проводник
      3. Номинал, А
      4. Количество проводников

    B. Мягкие

      1. Корпус

    C. Пересчет

      1. Длина, мм

    E. Цена

      1. руб.

